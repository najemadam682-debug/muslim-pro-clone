<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muslim App Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00796b">
    <style>
        :root { --primary: #00796b; --bg: #f0f4f3; }
        body { font-family: sans-serif; margin: 0; background: var(--bg); padding-bottom: 70px; }
        
        /* Header */
        .header { background: var(--primary); color: white; padding: 30px 20px; text-align: center; border-radius: 0 0 20px 20px; }
        
        /* Contenuto */
        .content { padding: 20px; display: none; }
        .active { display: block; }
        
        /* Card */
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .prayer-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; }
        
        /* Menu Basso */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .nav-item { border: none; background: none; color: #666; font-size: 12px; cursor: pointer; }
        .nav-item.active-nav { color: var(--primary); font-weight: bold; }

        /* Bussola */
        #qibla-arrow { font-size: 50px; transition: transform 0.5s; display: inline-block; }
    </style>
</head>
<body>

    <div id="home" class="content active">
        <div class="header">
            <h1>Orari Preghiera</h1>
            <p id="city">Rilevamento...</p>
        </div>
        <div class="card" id="prayer-list">Caricamento...</div>
    </div>

    <div id="quran" class="content">
        <div class="header"><h1>Sacro Corano</h1></div>
        <div class="card" id="quran-container">
            <p><i>"Leggi in nome del tuo Signore..."</i></p>
            <div id="verse-text" style="font-size: 20px; text-align: right; direction: rtl; margin-top: 20px;"></div>
            <p id="verse-translation" style="color: #666; font-style: italic;"></p>
        </div>
    </div>

    <div id="qibla" class="content">
        <div class="header"><h1>Bussola Qibla</h1></div>
        <div class="card" style="text-align: center;">
            <p>Direzione verso la Mecca</p>
            <div id="qibla-arrow">‚ñ≤</div>
            <p id="qibla-deg">--¬∞</p>
        </div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-item active-nav" onclick="showTab('home', this)">üè†<br>Home</button>
        <button class="nav-item" onclick="showTab('quran', this)">üìñ<br>Corano</button>
        <button class="nav-item" onclick="showTab('qibla', this)">üïã<br>Qibla</button>
    </nav>

    <script>
        // Gestione Tab
        function showTab(id, btn) {
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active-nav'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active-nav');
            if(id === 'quran') loadQuran();
            if(id === 'qibla') loadQibla();
        }

        // Caricamento Orari
        navigator.geolocation.getCurrentPosition(pos => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            fetch(`https://api.aladhan.com/v1/timingsByAddress?address=${lat},${lon}&method=3`)
                .then(res => res.json()).then(data => {
                    const t = data.data.timings;
                    document.getElementById('city').innerText = "La tua posizione";
                    document.getElementById('prayer-list').innerHTML = `
                        <div class="prayer-row"><span>Fajr</span><b>${t.Fajr}</b></div>
                        <div class="prayer-row"><span>Dhuhr</span><b>${t.Dhuhr}</b></div>
                        <div class="prayer-row"><span>Asr</span><b>${t.Asr}</b></div>
                        <div class="prayer-row"><span>Maghrib</span><b>${t.Maghrib}</b></div>
                        <div class="prayer-row"><span>Isha</span><b>${t.Isha}</b></div>
                    `;
                });
        });

        // Caricamento Corano (Versetto del giorno)
        function loadQuran() {
            fetch('https://api.alquran.cloud/v1/ayah/262/it.piccardo')
                .then(res => res.json()).then(data => {
                    document.getElementById('verse-text').innerText = data.data.text;
                    document.getElementById('verse-translation').innerText = "Surah Al-Baqarah, Ayah 262";
                });
        }

        // Calcolo Qibla (semplificato)
        function loadQibla() {
            navigator.geolocation.getCurrentPosition(pos => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                fetch(`https://api.aladhan.com/v1/qibla/${lat}/${lon}`)
                    .then(res => res.json()).then(data => {
                        const deg = data.data.direction;
                        document.getElementById('qibla-arrow').style.transform = `rotate(${deg}deg)`;
                        document.getElementById('qibla-deg').innerText = Math.round(deg) + "¬∞ rispetto al Nord";
                    });
            });
        }
    </script>
</body>
</html>
